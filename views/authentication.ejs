<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hosted Persona - Log In</title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<body class="auth">
<div id="page">
  <div id="content">
    <form action="/auth" method="POST">
      <input type="hidden" name="_csrf" value="<%= csrf_token %>" />
      <label for="email">Email</label><input type="email" id="email" name="email" value="" xdisabled="true" />
      <label for="password">Password</label><input type="password" id="password" name="password" value="" />
      <button>Sign In</button>
    </form>
  </div>
</div>
<script type="text/javascript" src="<%= browserid_server %>/authentication_api.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
function enableForm () {
  $('input, button').removeAttr('disabled');
}
function disableForm () {
  $('input, button').attr('disabled', 'true');
}
$('form').submit(function (e) {
  e.preventDefault();
  disableForm();
  $.ajax({
    type: 'POST',
    url: '/auth',
    data: {
      email: $('[name=email]').val(),
      password: $('[name=password]').val(),
      "_csrf": "<%= csrf_token %>"
    },
    success: function (data, status, xhr) {
      navigator.id.completeAuthentication();
    },
    complete: function (xhr, status) {
      enableForm();
    }
  })
  return false;
});
navigator.id.beginAuthentication(function(email) {
  $('[name=email]').val(email);
  $('[name=password]').focus();
});
</script>
</body>
</html>
